# AWS ElementalMediaConvert

## mp4 → m3u8 + ts 変換を行う

### 使用するサービス

- IAM
- S3
- MediaConvert

### 手順

1. (S3)バケット作成
   1. S3に下記バケット（必要に応じてディレクトリ）を作成する。
      - 変換元ファイルを配置するバケット（ディレクトリ）
      - 変換後ファイルを出力するバケット（ディレクトリ）
2. (S3)変換元ファイル登録
   1. 変換元ファイルを作成したバケット（ディレクトリ）に配置する。
3. (IAM)MediaConvert用のロールを作成する
   1. IAMダッシュボードに遷移する。
   2. 「ロール」を押下する。
   3. 「ロールの作成」ボタンを押下する。
   4. 「信頼されたエンティティの種類を選択」で「AWS サービス」を選択し、一覧から「MediaConvert」をクリック後に、「次のステップ:アクセス権限」ボタンを押下する。
   5. ポリシーを確認し、「次のステップ:タグ」を押下する。
   6. 任意のタグを入力し、「次のステップ:確認」を押下する。
   7. 任意のロール名を入力し、「ロールの作成」を押下する。
4. (MediaConvert)フロー作成
   1. AWS Elemental MediaConvertのホーム画面に遷移する。
   2. 「今すぐ始める」ボタンを押下する。
   3. 「入力ファイルURL」に変換元ファイルを入力する。
   4. 出力グループの「追加」ボタンを押下する。
   5. 出力グループの追加画面から、「Apple HLS」を選択し、「Select」ボタンを押下する。
   6. 「送信先」に変換後ファイルの出力先S3バケット（ディレクトリ）を入力する。
   7. 「出力グループ - Apple HLS - H.264, AAC」をクリックする。
   8. 「出力設定」と「エンコード設定」を指定する。
      - 以下、デフォルトのまま指定していない場合にエラーになる項目を記載。
           1. 「出力設定 - 名前修飾子」を指定する。
              - 変換後のファイル名に影響がある。
           2. 「エンコード設定 - ビットレート (ビット/秒)」を指定する。
   9. 「作成」ボタンを押下する。（画面下部）
5. (MediaConvert)フロー実行
   1. ジョブの終了を待つ。
      - ジョブは作成時に自動実行される。
      - 実行状況を確認したい場合、「ジョブ」→「ステータス」を確認する。
6. (S3)エンコード結果確認
   1. 指定したS3バケット（ディレクトリ）にエンコード舌ファイルが出力されていることを確認する。

### 参考

- [AWS:「AWS Elemental MediaConvert の開始方法」](https://aws.amazon.com/jp/mediaconvert/getting-started/)
- [AWS:MediaConvert:設定変数のリストと例](https://docs.aws.amazon.com/ja_jp/mediaconvert/latest/ug/list-of-settings-variables-with-examples.html)
  - 名前修飾子の一覧